# agents.md — v1.3

## 追加の指示
- このリポジトリに関する出力、コメント、コミットメッセージ、ドキュメント、PR 文面など、生成するテキストはすべて日本語で記述してください。
- コードスタイルや命名に迷った場合は読みやすさを優先してください。

## 1. プロダクト概要

ギターのコード進行をメモしたり、練習用に使用できる Web アプリ。
コード押さえ方表示 (svguitar) と、スケールとの対応（ディグリー）表示をサポートし、
作成したコード進行を **スケール情報と名前付きで保存・再利用** できる。

---

## 2. 技術要件・制約

- スマホ・PC 両対応のレスポンシブ Web アプリ
- 単一 Docker コンテナでフルスタック構成
- データは永続ボリュームへ保存
  - コードフォーム
  - コード進行（スケール情報・名前付き）
- UI: Tailwind CSS
- 音の再生機能は当面不要
- ログイン不要（ユーザー管理なし）

---

## 3. ドメイン仕様（音楽的要件）

### 対象楽器・ポジション
- 標準チューニング 6 弦ギター
- 押さえ方は 12 フレット程度までを想定

### コードタイプ（初期実装）
- m, aug, dim, 7, maj7, m7, dim7
- sus2, sus4
- add9, 9, 11, 13
- 分数コード（例: C/G）
- ♭5
（オルタード系は将来拡張）

### 対応スケール
- メジャー
- ナチュラルマイナー
- ハーモニックマイナー
- メロディックマイナー

### デフォルトスケール
- アプリ起動時・新規コード進行作成時のデフォルトスケールは **C メジャー** とする。

### ディグリー表記
- ローマ数字表記（例：I, ii, vii°）
- 品質を含む記述（例：iiø7）

---

## 4. 機能要件

### 4.1 コード選択・追加 UI
- 画面下部にルート音ボタン（12 音）
- 選択したルートに応じてコードタイプボタン表示
- 「追加」操作でコード進行エリアに追加

### 4.2 コード進行の編集
- 並び替え（ドラッグ＆ドロップ）
- 編集（ルート音・コードタイプ変更）
- 削除

### 4.3 コードフォーム表示（svguitar）
- コード選択時に押さえ方表示
- 未登録フォームは追加ダイアログで登録可能
- 保存データは永続化する

### 4.4 スケール選択とダイアトニック表示
- スケール選択 UI：
  - Key + スケール種類（4 種）
- 一覧表示：
  - ダイアトニックコード
  - 対応ディグリー

### 4.5 コード進行とスケールの対応表示
- 進行内のコードごとにディグリー表示
- スケール外は適切に非対応扱いが分かる表示

---

### 4.6 ルート音ハイライト

- スケールを選択した際、
  - コード下部のルート音ボタン群の中で
  - **そのスケールに含まれる音**（ダイアトニックルート）を
    **視覚的にハイライトする**

例：C メジャー選択時
- ハイライト: C, D, E, F, G, A, B
- 非ダイアトニック（例: C#）はハイライトなし

※ 表示方式は UI 設計段階で詳細を決定（色付け / 枠強調 / ラベル追加など）

---

### 4.7 コード進行の保存・読み込み

- ユーザーが画面上部のコード進行エリアに並べたコード列を、**サーバ側に保存**できるようにする。
- 保存時に含める情報：
  - コードの並び（Chord のリスト）
  - 使用中のスケール情報
    - Key（例: C, G, D ...）
    - スケール種類（メジャー / ナチュラル / ハーモニック / メロディック）
  - コード進行の名前（ユーザーが任意に入力する文字列）
- デフォルト挙動：
  - 新規作成時のスケールは **C メジャー** を初期値とする。
- ユーザー管理は行わないため、
  - 保存されたコード進行は「アプリ共通データ」として扱う（ローカルサーバ用途を想定）。
- 進行一覧機能：
  - 保存されたコード進行の一覧を取得し、選択して読み込めるようにする。
  - 読み込むと、
    - コード進行エリアにコードが復元され
    - スケール選択 UI も復元されたスケール状態に同期する。

---

## 5. データモデル（概念レベル）

※ 実装詳細は含めない

- **Chord**
  - ルート音
  - コードタイプ
  - 表示名（例：Cmaj7）

- **ChordShape**
  - 対応する Chord 情報
  - ポジション情報（開始フレットなど）
  - 押さえ方構造（弦・フレット・ミュート・開放など）

- **Progression**
  - ID（内部識別子）
  - 名前（ユーザーが付ける任意の名称）
  - コードの並び（Chord の配列）
  - スケール情報
    - Key（例：C, G ...）
    - 種類（メジャー / ナチュラル / ハーモニック / メロディック）
  - 作成日時 / 更新日時（必要に応じて）

- **Scale**
  - Key
  - 種類
  - 構成音
  - ダイアトニックコードとディグリー

---
